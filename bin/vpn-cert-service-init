#!/usr/bin/php
<?php

require_once 'vendor/autoload.php';

use fkooman\VPN\EasyRsa;

$EASY_RSA_PATH = '/usr/share/easy-rsa/2.0';
$DATA_DIR = dirname(__DIR__)."/data";
$EASY_RSA_TARGET_CONFIG_PATH = $DATA_DIR."/easy-rsa";
if (!file_exists($EASY_RSA_TARGET_CONFIG_PATH)) {
    mkdir($EASY_RSA_TARGET_CONFIG_PATH);
}
foreach (glob($EASY_RSA_PATH."/*") as $file) {
    $fp = fileperms($file);
    copy($file, $EASY_RSA_TARGET_CONFIG_PATH."/".basename($file));
    // also keep file permissions
    chmod($EASY_RSA_TARGET_CONFIG_PATH."/".basename($file), $fp);
}
# update configuration in "vars"
//export KEY_EXPIRE=3650

$e = new EasyRsa($EASY_RSA_TARGET_CONFIG_PATH);
$e->cleanAll();
$e->initCa();
$e->generateServerCert("s3rv3r");
//echo $e->generateClientCert("client1");
//$e->generateClientCert("client11");
//$e->generateClientCert("client111");
//$e->revokeClientCert("client11");
