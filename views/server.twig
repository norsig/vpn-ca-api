# OpenVPN Server Configuration for {{ cn|e }}

dev tun

# UDP
proto udp
port 1194

# UDP6 (works also for UDP)
#proto udp6
#port 1194

# TCP
#proto tcp-server
#port 443
#port-share localhost 8443

# TCP6
# does not work with port-share (tested with OpenVPN 2.3.8 and 2.3.9)
# see https://community.openvpn.net/openvpn/ticket/336
#proto tcp6-server
#port 443
#port-share localhost 8443

# IPv4
# Replace 42.42 with 2 random numbers between 0 and 255, e.g. 10.232.217.0 if
# you do not have publically routable addresses
server 10.42.42.0 255.255.255.0
push "redirect-gateway def1 bypass-dhcp"

# for Windows clients we need this extra route to mark the TAP adapter as 
# trusted and as having "Internet" access to allow the user to set it to 
# "Home" or "Work" to allow accessing file shares and printers
push "route 0.0.0.0 0.0.0.0"

# IPv6
# Use `openssl rand -hex 5` to uniquely generate 40 bits for a ULA address in
# fd00::/8, e.g. fd07:787e:63f9::/64 if you do not have publically routable
# addresses, see: https://en.wikipedia.org/wiki/Unique_local_address 
server-ipv6 fd00:4242:4242::/64
# for iOS we need this OpenVPN 2.4 "ipv6" flag to redirect-gateway
# See https://docs.openvpn.net/docs/openvpn-connect/openvpn-connect-ios-faq.html
push "redirect-gateway ipv6"
push "route-ipv6 ::/0"

topology subnet
# enable comp-lzo
comp-lzo yes
push "comp-lzo yes"
persist-key
persist-tun
verb 3
max-clients 100
keepalive 10 30
user openvpn
group openvpn
remote-cert-tls client

# CRYPTO
#
# See RFC 7525 for TLS configuration recommendations
# See https://bettercrypto.org for more OpenVPN configuration guidelines
# OpenVPN does not support ECDHE (https://community.openvpn.net/openvpn/wiki/Hardening)

auth SHA256
cipher AES-256-CBC
tls-version-min 1.2
tls-cipher TLS-DHE-RSA-WITH-AES-128-GCM-SHA256:TLS-DHE-RSA-WITH-AES-256-GCM-SHA384

script-security 1

# CRL, you MUST enable this in production, but first revoke a configuration
# as OpenVPN chokes on empty CRL files
#crl-verify /var/lib/vpn-server-api/ca.crl

# ask client to tell us on disconnect
push "explicit-exit-notify 3"

# Use Google Public DNS by default
# https://developers.google.com/speed/public-dns/
push "dhcp-option DNS 8.8.8.8"
push "dhcp-option DNS 8.8.4.4"
#push "dhcp-option DNS 2001:4860:4860::8888"
#push "dhcp-option DNS 2001:4860:4860::8844"

# disable "netbios", i.e. Windows file sharing over TCP/IP
#push "dhcp-option DISABLE-NBT"

# also send a NTP server
#push "dhcp-option NTP time.example.org"

# allow client-to-client communication, see openvpn(8)
#client-to-client

# load client specific configuration (for handling e.g. "disable" or custom
# routes)
#client-config-dir /var/lib/vpn-server-api/ccd

# need to allow 7505 also with SELinux
#management localhost 7505

ca [inline]
cert [inline]
key [inline]
tls-auth [inline] 0

<ca>
{{ ca|e }}
</ca>
<cert>
{{ cert|e }}
</cert>
<key>
{{ key|e }}
</key>
<dh>
{{ dh|e }}
</dh>
<tls-auth>
{{ ta|e }}
</tls-auth>
